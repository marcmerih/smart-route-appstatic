import { Component, OnInit } from '@angular/core';
import { MatDialog } from '@angular/material/dialog';
import { AddIntermediateStopComponent } from '../add-intermediate-stop/add-intermediate-stop.component';
import { TripService } from '../trip.service';
import { FormGroup, FormControl } from '@angular/forms';
import { TripSettingsComponent } from '../trip-settings/trip-settings.component';
import { HttpClient } from '@angular/common/http';
import { Router, Params, ActivatedRoute } from '@angular/router';
import { RoutesComponent } from '../routes/routes.component';
import { RoutingSteps, TripSettings, RouteModel, RestaurantsModel } from '../models';

@Component({
  selector: 'app-trip-overlay',
  templateUrl: './trip-overlay.component.html',
  styleUrls: ['./trip-overlay.component.scss']
})
export class TripOverlayComponent implements OnInit {
  hasBeenRouted = false;
  routingSteps: any = RoutingSteps;
  currentStep: RoutingSteps = RoutingSteps.routeStartEnd;
  startTripForm: FormGroup;
  sortFormGroup: FormGroup;
  intermediateLocationAddress = '';
  addresses = [];
  currentRoute: any;
  restaurantClicked = false;
  hotelsClicked = false;
  ttdClicked = false;
  tripSettings: TripSettings = new TripSettings;
  restaurants;
  sortOptions = [
    {value: 'recommended', viewValue: 'Recommended'},
    {value: 'price-ascending', viewValue: 'Price: High-to-Low'},
    {value: 'price-descending', viewValue: 'Price: Low-to-High'}
  ];
  defaulOption = {value: 'recommended', viewValue: 'Recommended'};
  mockRestaurants = 
  {
    "listOfRestaurantsInfo": [['Prime Steakhouse Niagara Falls', '5685 Falls Avenue, Niagara Falls, Ontario L2E 6W7 Canada', 4.8],
    ['Est Restaurant', '729 Queen St E, Toronto, Ontario M4M 1H1 Canada', 4.8],
    ["lo Presti's at Maxwell's", 'Jackson st.e, Hamilton, Ontario Canada', 4.7],
    ['Tide and Vine Oyster House', '3491 Portage Rd, Niagara Falls, Ontario L2J 2K5 Canada', 4.7],
    ['Beechwood Doughnuts', '165 St. Paul Street, St. Catharines, Ontario L2R 3M5 Canada', 4.7]],
    "listOfRestaurantsCoords": [[-79.07169652, 43.09269115], [-79.3489562, 43.65893534], [-79.86933370000001, 43.2543027], [-79.09977664, 43.1215245], [-79.24467442, 43.15773514]] 
  };


  constructor(private dialog: MatDialog, private router: Router, private activatedRoute: ActivatedRoute,
    private tripService: TripService, private http: HttpClient) {
    this.startTripForm = this.tripService.tripSetupForm;
    this.sortFormGroup = new FormGroup({
      sortBy: new FormControl('')
    });
    this.tripSettings.maximumDetourDuration = 100;
    this.restaurants = [];
  }

  ngOnInit(): void {
    // this.restaurants = this.mockRestaurants;
    // console.log(this.restaurants);
  }

  route() {
    const queryParams: Params = { startingLocation: this.startingLocation, 
      endingLocation: this.endingLocation,
      maximumDetour: this.tripSettings.maximumDetourDuration  
    };
    this.router.navigate(
      [], 
      {
        relativeTo: this.activatedRoute,
        queryParams: queryParams, 
        queryParamsHandling: 'merge', // remove to replace all query params by provided
      });

    this.hasBeenRouted = true;
    this.currentStep = this.routingSteps.tripDetails;
    this.tripService.route(this.startingLocation, this.endingLocation, this.tripSettings.maximumDetourDuration).subscribe((request: RouteModel) => {
      this.currentRoute = JSON.parse(request.listOfNodes)
      this.tripService.setListOfNodes(this.currentRoute);
    });
    // this.tripService.setListOfNodes([[-78.964608, 42.892154], [-78.964624, 42.893501], [-78.965899, 42.89347], [-78.965886, 42.894595], [-78.96591, 42.895352], [-78.965948, 42.896225], [-78.966, 42.897452], [-78.965099, 42.898057], [-78.964931, 42.89829], [-78.964893, 42.898342], [-78.964945, 42.900855], [-78.965012, 42.903684], [-78.965039, 42.90472], [-78.965056, 42.905521], [-78.965058, 42.905621], [-78.965065, 42.906049], [-78.965097, 42.90809], [-78.965117, 42.909356], [-78.965121, 42.909662], [-78.965133, 42.910412], [-78.965142, 42.911061], [-78.965147, 42.911421], [-78.965153, 42.911898], [-78.965158, 42.912259], [-78.965565, 42.915544], [-78.965716, 42.916068], [-78.96573, 42.916114], [-78.965903, 42.916423], [-78.966128, 42.916652], [-78.966965, 42.917289], [-78.967182, 42.917392], [-78.967558, 42.917515], [-78.968082, 42.917606], [-78.971513, 42.917946], [-78.971657, 42.918038], [-78.971751, 42.918175], [-78.971787, 42.918562], [-78.971653, 42.918789], [-78.971331, 42.918993], [-78.971208, 42.919048], [-78.970827, 42.919059], [-78.968583, 42.919069], [-78.967552, 42.919101], [-78.965555, 42.919221], [-78.966942, 42.919286], [-78.967465, 42.919395], [-78.967749, 42.919518], [-78.967942, 42.91962], [-78.968625, 42.920092], [-78.971178, 42.922199], [-78.979671, 42.930161], [-78.982891, 42.933203], [-78.985127, 42.935187], [-78.987803, 42.937287], [-78.989262, 42.938421], [-78.994164, 42.942208], [-79.0, 42.946889], [-79.000005, 42.946893], [-79.003662, 42.94983], [-79.005624, 42.951305], [-79.00614, 42.951665], 
    //   [-79.007109, 42.952411], [-79.010665, 42.955039], [-79.018533, 42.96084], [-79.021829, 42.963273], [-79.022093, 42.963462], [-79.024605, 42.965339], [-79.029209, 42.968746], [-79.029564, 42.969009], [-79.029624, 42.969055], [-79.030402, 42.969626], [-79.034103, 42.9724], [-79.052972, 42.986869], [-79.056895, 42.989904], [-79.057798, 42.990598], [-79.06129, 42.993458], [-79.069147, 43.0], [-79.072563, 43.002715], [-79.090664, 43.015964], [-79.095325, 43.019403], [-79.106968, 43.028298], [-79.108118, 43.029172], [-79.108379, 43.029369], [-79.108393, 43.029381], [-79.1105, 43.030967], [-79.110639, 43.031079], [-79.110885, 43.031275], [-79.112187, 43.032313], [-79.114833, 43.034312], [-79.115117, 43.034525], [-79.116113, 43.035309], [-79.117014, 43.036081], [-79.118242, 43.037354], [-79.118757, 43.037988], [-79.119465, 43.039026], [-79.11998, 43.039948], [-79.120538, 43.041134], [-79.120779, 43.041747], [-79.121003, 43.042417], [-79.121136, 43.042935], [-79.121164, 43.043066], [-79.121183, 43.043158], [-79.12124, 43.043427], [-79.121334, 43.043925], [-79.121386, 43.04437], [-79.121501, 43.045637], [-79.121642, 43.047012], [-79.122241, 43.053131], [-79.122357, 43.057375], [-79.122454, 43.063463], [-79.122329, 43.064731], [-79.122029, 43.066104], [-79.120582, 43.071267], [-79.119423, 43.075435], [-79.118647, 43.078303], [-79.118411, 43.079983], [-79.118385, 43.080451], [-79.118383, 43.08094], [-79.118898, 43.090968], [-79.119046, 43.094572], [-79.118712, 43.096251], [-79.118519, 43.096932], [-79.118395, 43.09738], [-79.118129, 43.098643], 
    //   [-79.118097, 43.098993], [-79.118191, 43.10042], [-79.118486, 43.101614], [-79.119207, 43.103751], [-79.119641, 43.106054], [-79.11965, 43.106221], [-79.120052, 43.113167], [-79.120072, 43.113464], [-79.120262, 43.116296], [-79.120556, 43.120701], [-79.121131, 43.122827], [-79.121704, 43.124178], [-79.122345, 43.125305], [-79.12278, 43.125961], [-79.12375, 43.127219], [-79.12748, 43.131071], [-79.131082, 43.134723], [-79.133526, 43.13723], [-79.142008, 43.145854], [-79.142168, 43.146031], [-79.143975, 43.147853], [-79.144864, 43.148653], [-79.145675, 43.149306], [-79.146406, 43.149856], [-79.147564, 43.150583], [-79.148341, 43.151027], [-79.149545, 43.151658], [-79.150933, 43.152312], [-79.153326, 43.153249], [-79.155181, 43.153942], [-79.157422, 43.154731], [-79.158886, 43.155248], [-79.159837, 43.155582], [-79.166386, 43.157888], [-79.170117, 43.159268], [-79.171719, 43.159861], [-79.174719, 43.161017], [-79.175815, 43.16144], [-79.178899, 43.16269], [-79.180888, 43.163495], [-79.182074, 43.163976], [-79.184423, 43.164894], [-79.185389, 43.165295], [-79.187615, 43.1662], [-79.188847, 43.166663], [-79.190158, 43.167036], [-79.191339, 43.167228], [-79.191955, 43.167307], [-79.192541, 43.167349], [-79.193674, 43.167374], [-79.202414, 43.167387], [-79.203686, 43.167397], [-79.204969, 43.167436], [-79.205651, 43.16748], [-79.206388, 43.167546], [-79.207425, 43.167673], [-79.208707, 43.167881], [-79.209541, 43.168057], [-79.21041, 43.168247], [-79.210867, 43.168352], [-79.211673, 43.168542], [-79.214968, 43.16939], [-79.218376, 43.170198], 
    //   [-79.223131, 43.171349], [-79.223516, 43.171444], [-79.224088, 43.171584], [-79.225637, 43.171963], [-79.228984, 43.172795], [-79.230354, 43.17312], [-79.230941, 43.173258], [-79.233027, 43.173697], [-79.235537, 43.174164], [-79.235636, 43.174185], [-79.235825, 43.17421], [-79.239164, 43.174817], [-79.240511, 43.17513], [-79.24084, 43.175192], [-79.244399, 43.175915], [-79.24702, 43.176406], [-79.248704, 43.176732], [-79.253952, 43.177653], [-79.254532, 43.177766], [-79.256305, 43.178113], [-79.257964, 43.178426], [-79.259812, 43.178774], [-79.260686, 43.178952], [-79.263283, 43.17948], [-79.264787, 43.179677], [-79.265516, 43.17974], [-79.266569, 43.179758], [-79.267382, 43.179725], [-79.26808, 43.17965], [-79.269088, 43.179475], [-79.27014, 43.17923], [-79.270816, 43.17907], [-79.27121, 43.178962], [-79.273983, 43.178217], [-79.276102, 43.177609], [-79.276238, 43.17757], [-79.276824, 43.177417], [-79.277284, 43.177334], [-79.277782, 43.177264], [-79.278727, 43.177174], [-79.279137, 43.17715], [-79.27961, 43.177147], [-79.280766, 43.17722], [-79.284231, 43.177525], [-79.287379, 43.177788], [-79.287987, 43.177837], [-79.293668, 43.178315], [-79.300372, 43.178923], [-79.305641, 43.179366], [-79.30946, 43.179648], [-79.314303, 43.180049], [-79.316825, 43.180194], [-79.319397, 43.180194], [-79.320478, 43.180207], [-79.321195, 43.180193], [-79.326416, 43.180043], [-79.327152, 43.18002], [-79.338523, 43.179755], [-79.339222, 43.179739], [-79.351128, 43.179417], [-79.355932, 43.179402], [-79.358371, 43.179653], [-79.359969, 43.179943], [-79.36123, 43.180264], 
    //   [-79.361738, 43.180394], [-79.363035, 43.18077], [-79.3647, 43.181387], [-79.365603, 43.18179], [-79.367284, 43.182545], [-79.370523, 43.183904], [-79.372986, 43.184833], [-79.373915, 43.185144], [-79.374869, 43.185442], [-79.376141, 43.185758], [-79.377424, 43.186045], [-79.37865, 43.186285], [-79.37984, 43.186459], [-79.381009, 43.186607], [-79.382197, 43.186712], [-79.383295, 43.186774], [-79.3845, 43.186807], [-79.385144, 43.186808], [-79.385974, 43.186785], [-79.389436, 43.186706], [-79.394403, 43.1866], [-79.395493, 43.18661], [-79.399712, 43.186741], [-79.404806, 43.186904], [-79.409843, 43.187063], [-79.412063, 43.187142], [-79.426937, 43.1876], [-79.430717, 43.187723], [-79.432667, 43.187786], [-79.437548, 43.187939], [-79.442942, 43.188111], [-79.443071, 43.188115], [-79.44387, 43.188141], [-79.45811, 43.188583], [-79.468573, 43.188917], [-79.470841, 43.188992], [-79.474873, 43.189112], [-79.477735, 43.189187], [-79.483813, 43.189392], [-79.487143, 43.18947], [-79.510509, 43.189347], [-79.516971, 43.189352], [-79.517367, 43.189355], [-79.518686, 43.189404], [-79.520256, 43.189533], [-79.521887, 43.189733], [-79.523475, 43.189994], [-79.524058, 43.19009], [-79.524454, 43.190168], [-79.528648, 43.190937], [-79.531045, 43.191465], [-79.531802, 43.191621], [-79.534123, 43.192177], [-79.537678, 43.193076], [-79.546263, 43.195165], [-79.547919, 43.195547], [-79.551474, 43.196449], [-79.555089, 43.197325], [-79.559542, 43.198404], [-79.559905, 43.198491], [-79.562551, 43.199145], [-79.566399, 43.200039], [-79.568592, 43.200602], [-79.575264, 43.202265], 
    //   [-79.579084, 43.203166], [-79.584753, 43.204557], [-79.588737, 43.205525], [-79.591556, 43.206195], [-79.597658, 43.207665], [-79.602439, 43.208823], [-79.604329, 43.209313], [-79.610104, 43.210687], [-79.61388, 43.211607], [-79.617642, 43.212485], [-79.62278, 43.213746], [-79.630617, 43.215685], [-79.634474, 43.216631], [-79.637733, 43.217374], [-79.641741, 43.218369], [-79.645349, 43.21925], [-79.648636, 43.22003], [-79.653867, 43.221306], [-79.660186, 43.222793], [-79.664795, 43.223935], [-79.670777, 43.225374], [-79.675781, 43.226612], [-79.680428, 43.227711], [-79.685918, 43.229051], [-79.689745, 43.229999], [-79.692302, 43.230616], [-79.703036, 43.233183], [-79.704221, 43.233468], [-79.713387, 43.235678], [-79.717337, 43.236606], [-79.723698, 43.238198], [-79.735736, 43.241124], [-79.740564, 43.242279], [-79.743272, 43.242951], [-79.743507, 43.242969], [-79.744285, 43.243153], [-79.749264, 43.244332], [-79.752019, 43.244988], [-79.755023, 43.245701], [-79.757314, 43.246304], [-79.75771, 43.246422], [-79.758513, 43.246749], [-79.759118, 43.247056], [-79.759559, 43.247324], [-79.759913, 43.247581], [-79.760191, 43.247816], [-79.760497, 43.248099], [-79.760765, 43.248413], [-79.761156, 43.248938], [-79.763343, 43.252071], [-79.76497, 43.254349], [-79.766074, 43.255864], [-79.768362, 43.25913], [-79.768462, 43.259272], [-79.769623, 43.260864], [-79.770063, 43.261432], [-79.770661, 43.262135], [-79.771265, 43.2628], [-79.771726, 43.26325], [-79.772033, 43.26357], [-79.773136, 43.264719], [-79.774653, 43.266319], [-79.774955, 43.26664], [-79.778568, 43.270428], [-79.785607, 43.277793], [-79.786122, 43.278562], [-79.786439, 43.279191], [-79.787813, 43.282105], [-79.789508, 43.285428], [-79.78971, 43.285775], [-79.790825, 43.287718], [-79.791548, 43.288949], 
    //   [-79.795133, 43.295164], [-79.79611, 43.296893], [-79.796551, 43.297655], [-79.797721, 43.299658], [-79.801125, 43.305563], [-79.801559, 43.306325], [-79.801949, 43.306988], [-79.802749, 43.308354], [-79.803086, 43.308936], [-79.803536, 43.30971], [-79.803777, 43.310221], [-79.804573, 43.312186], [-79.805133, 43.313093], [-79.805751, 43.313831], [-79.80661, 43.314637], [-79.806957, 43.314875], [-79.807152, 43.315002], [-79.807509, 43.315234], [-79.809406, 43.31648], [-79.810453, 43.317163], [-79.811365, 43.317762], [-79.815144, 43.320132], [-79.816282, 43.320834], [-79.816563, 43.321014], [-79.818486, 43.3222], [-79.819278, 43.322713], [-79.821608, 43.324204], [-79.821776, 43.324313], [-79.82218, 43.324596], [-79.82309, 43.325296], [-79.824439, 43.326571], [-79.825187, 43.327436], [-79.825422, 43.327751], [-79.82557, 43.327958], [-79.825748, 43.328114], [-79.826068, 43.328565], [-79.826442, 43.329143], [-79.826888, 43.329906], [-79.827176, 43.330452], [-79.828561, 43.332942], [-79.828807, 43.333552], [-79.828965, 43.334103], [-79.829047, 43.334642], [-79.829065, 43.335221], [-79.829039, 43.335607], [-79.828993, 43.335912], [-79.828911, 43.336268], [-79.828801, 43.336633], [-79.828676, 43.33695], [-79.828403, 43.337511], [-79.828188, 43.337836], [-79.827749, 43.338391], [-79.827339, 43.338824], [-79.826967, 43.33916], [-79.826649, 43.339405], [-79.826138, 43.339759], [-79.825712, 43.340008], [-79.825216, 43.340256], [-79.82248, 43.341533], [-79.821955, 43.34177], [-79.821594, 43.34194], [-79.821409, 43.341991], [-79.818615, 43.343312], [-79.817728, 43.343702], [-79.814308, 43.345343], [-79.813793, 43.345579], [-79.812229, 43.346302], [-79.811349, 43.346732], [-79.810302, 43.347213], [-79.808832, 43.347995], [-79.806875, 43.349312], [-79.806534, 43.349571], [-79.805708, 43.350213], [-79.804318, 43.351373], [-79.803656, 43.351948], [-79.799494, 43.355772], [-79.794773, 43.360105], [-79.794529, 43.360326], [-79.792003, 43.362574], [-79.791718, 43.362866], [-79.791176, 43.36338], [-79.788541, 43.365721], [-79.787821, 43.366319], [-79.785506, 43.368429], [-79.784508, 43.369339], [-79.777856, 43.375423], [-79.775079, 43.377964], [-79.774784, 43.378235], [-79.773399, 43.379512], [-79.771198, 43.381514], [-79.767293, 43.385063], [-79.763505, 43.38857], [-79.762874, 43.38915], [-79.759822, 43.39197], [-79.759508, 43.392283], [-79.756107, 43.395409], [-79.751111, 43.400052], [-79.746834, 43.403999], [-79.743515, 43.4069], [-79.742193, 43.408056], [-79.740775, 43.409333], [-79.740263, 43.409844], [-79.739589, 43.410523], [-79.73773, 43.412418], [-79.737069, 43.413042], [-79.735223, 43.414693], [-79.730483, 43.419053], [-79.728855, 43.420475], [-79.725009, 43.423963], [-79.723853, 43.425009], [-79.72094, 43.427648], [-79.718005, 43.430366], [-79.715869, 43.432184], [-79.710193, 43.437327], [-79.708417, 43.438904], [-79.70697, 43.440211], [
    //     -79.703165, 43.443574], [-79.70128, 43.445333], [-79.700027, 43.446373], [-79.699196, 43.44709], [-79.698694, 43.447502], [-79.697465, 43.448608], [-79.69541, 43.450547], [-79.694792, 43.451114], [-79.693276, 43.452536], [-79.692485, 43.453322], [-79.689785, 43.455677], [-79.686733, 43.458385], [-79.686564, 43.45856], [-79.683234, 43.461657], [-79.682161, 43.462628], [-79.680261, 43.464438], [-79.676779, 43.467677], [-79.675966, 43.468458], [-79.675552, 43.469022], [-79.674779, 43.469994], [-79.673981, 43.47118], [-79.673337, 43.472474], [-79.673079, 43.473119], [-79.67263, 43.474448], [-79.672513, 43.47504], [-79.672346, 43.476082], [-79.672219, 43.477578], [-79.672482, 43.481514], [-79.672881, 43.488326], [-79.673204, 43.492523], [-79.673332, 43.494484], [-79.67335, 43.494929], [-79.673379, 43.495388], [-79.673514, 43.497626], [-79.673533, 43.49817], [-79.673511, 43.498434], [-79.67347, 43.498735], [-79.67334, 43.499407], [-79.673247, 43.499699], [-79.673166, 43.499954], [-79.672984, 43.500394], [-79.672779, 43.500795], [-79.672354, 43.501475], [-79.671997, 43.501923], [-79.671694, 43.502262], [-79.671379, 43.502583], [-79.670812, 43.50308], [-79.669302, 43.504485], [-79.667519, 43.506091], [-79.667353, 43.506263], [-79.660802, 43.512292], [-79.660514, 43.512513], [-79.657702, 43.51513], [-79.656378, 43.516331], [-79.654246, 43.518286], [-79.651553, 43.520724], [-79.651159, 43.521137], [-79.648063, 43.523917], [-79.647669, 43.524285], [-79.647472, 43.524462], [-79.646549, 43.525297], [-79.645334, 43.526476], [-79.6439, 43.527741], [-79.641124, 43.530283], [-79.636177, 43.534752], [-79.630657, 43.539833], [-79.622899, 43.546908], [-79.62221, 43.547443], [-79.62131, 43.548103], [-79.619692, 43.549066], [-79.618362, 43.549702], [-79.61795, 43.549899], [-79.616697, 43.550413], [-79.615908, 43.55077], [-79.61497, 43.551282], [-79.61392, 43.551996], [-79.613721, 43.552133], [-79.613453, 43.552319], [-79.613267, 43.55248], [-79.613024, 43.552692], [-79.612749, 43.552946], [-79.612342, 43.553327], [-79.612151, 43.55351], [-79.611616, 43.554147], [-79.611147, 43.554813], [-79.610841, 43.55523], [-79.610731, 43.555374], [-79.609399, 43.557168], [-79.608261, 43.558749], [-79.605495, 43.562549], [-79.605022, 43.563164], [-79.604402, 43.563843], [-79.603994, 43.564213], [-79.603235, 43.564925], [-79.603176, 43.564982], [-79.601281, 43.566812], [-79.600665, 43.567355], [-79.600129, 43.567866], [-79.599758, 43.568181], [-79.598785, 43.569084], [-79.598651, 43.56921], [-79.598125, 43.569703], [-79.596527, 43.571179], [-79.595421, 43.572146], [-79.593713, 43.573712], [-79.593471, 43.573931], [-79.593287, 43.574097], [-79.588826, 43.578212], [-79.58564, 43.581107], [-79.584931, 43.581772], [-79.583812, 43.582797], [-79.582282, 43.584188], [-79.580133, 43.586135], [-79.579483, 43.586728], [-79.576958, 43.589071], [-79.574631, 43.59124], [-79.56966, 43.595843], [-79.569071, 43.596384], [-79.568661, 43.596761], [-79.565812, 43.599358], [-79.56447, 43.600562], [-79.562722, 43.602126], [-79.560649, 43.603948], [-79.559702, 43.604822], [-79.559354, 43.605142], [-79.558466, 43.605953], [-79.557414, 43.606944], [-79.554197, 43.609832], [-79.553043, 43.610908], [-79.551862, 43.611923], [-79.551457, 43.612236], [-79.551044, 43.612523], [-79.550417, 43.612904], [-79.549958, 43.613143], [-79.549352, 43.613411], [-79.548817, 43.613607], [-79.54845, 43.613752], [-79.547693, 43.61398], [-79.547117, 43.614127], [-79.546834, 43.614189], [-79.546546, 43.614248], [-79.54594, 43.614345], [-79.545334, 43.614427], [-79.544854, 43.614489], [-79.542967, 43.614732], [-79.541308, 43.61495], [-79.540357, 43.61504], [-79.539893, 43.615107], [-79.538085, 43.615408], [-79.536298, 43.615751], [-79.532061, 43.6166], [-79.53086, 43.616829], [-79.529863, 43.617035], [-79.529251, 43.617156], [-79.528295, 43.617354], [-79.526002, 43.617815], [-79.510593, 43.620825], [-79.501196, 43.62274], [-79.500137, 43.622934], [-79.497207, 43.623643], [-79.496796, 43.623742], [-79.493307, 43.624586], [-79.492696, 43.624735], [-79.490263, 43.62531], [-79.4889, 43.625661], [-79.48822, 43.62583], [-79.487697, 43.625963], [-79.486799, 43.626164], [-79.48642, 43.626252], [-79.4857, 43.626422], [-79.485305, 43.626524], [-79.483827, 43.626905], [-79.483289, 43.627025], [-79.482128, 43.627343], [-79.481812, 43.627449], [-79.481282, 43.627657], [-79.480853, 43.62786], [-79.480537, 43.628014], [-79.480286, 43.628161], [-79.480027, 43.628332], [-79.479278, 43.628901], [-79.478249, 43.629754], [-79.477992, 43.629941], [-79.477369, 43.630419], [-79.475367, 43.631894], [-79.474831, 43.632252], [-79.474208, 43.632606], [-79.473197, 43.633125], [-79.47254, 43.63349], [-79.472011, 43.633802], [-79.471272, 43.634244], [-79.470464, 43.634733], [-79.469653, 43.635209], [-79.469015, 43.635528], [-79.468844, 43.63561], [-79.468412, 43.635795], [-79.466553, 43.636599], [-79.465849, 43.636902], [-79.465164, 43.637168], [-79.464751, 43.637322], [-79.4636, 43.637704], [-79.462577, 43.637995], [-79.46144, 43.63826], [-79.460284, 43.638489], [-79.459468, 43.638623], [-79.459196, 43.638663], [-79.458834, 43.638712], [-79.458465, 43.638756], [-79.457699, 43.638828], [-79.456707, 43.638886], [-79.455551, 43.638905], [-79.45499, 43.638895], [-79.453887, 43.638847], [-79.453463, 43.638822], [-79.452482, 43.638744], [-79.451402, 43.638629], [-79.45069, 43.638533], [-79.44951, 43.638349], [-79.448023, 43.638056], [-79.446728, 43.637741], [-79.446279, 43.637616], [-79.445607, 43.637412], [-79.44507, 43.637247], [-79.444666, 43.637109], [-79.44374, 43.636738], [-79.44098, 43.635568], [-79.437526, 43.634103], [-79.436737, 43.633756], [-79.435105, 43.633067], [-79.434723, 43.632925], [-79.434156, 43.632746], [-79.433424, 43.632574], [-79.4327, 43.632469], [-79.431952, 43.632408], [-79.431548, 43.6324], [-79.430991, 43.63242], [-79.430469, 43.632462], [-79.430145, 43.632496], [-79.429166, 43.632717], [-79.428636, 43.632844], [-79.428005, 43.633032], [-79.425151, 43.6338], [-79.421703, 43.634728], [-79.421314, 43.63484], [-79.418281, 43.635715], [-79.414238, 43.636853], [-79.413152, 43.637134], [-79.412216, 43.637304], [-79.411836, 43.63735], [-79.41163, 43.637374], [-79.410716, 43.637426], [-79.4087, 43.637429], [-79.407575, 43.637462], [-79.406782, 43.63752], [-79.403008, 43.637866], [-79.402605, 43.637889], [-79.402384, 43.637902], [-79.401749, 43.637919], [-79.401191, 43.637913], [-79.400392, 43.637881], [-79.399999, 43.637865], [-79.399006, 43.637833], [-79.398693, 43.637775], [-79.397823, 43.637724], [-79.397282, 43.637726], [-79.39708, 43.637746], [-79.396122, 43.637904], [-79.394924, 43.638101], [-79.393404, 43.638352], [-79.393114, 43.6384], [-79.392766, 43.63846], [-79.392469, 43.638535], [-79.392367, 43.638564], [-79.392316, 43.638581], [-79.392248, 43.638623], [-79.392195, 43.638683], [-79.392465, 43.639333], [-79.392514, 43.639469], [-79.39259, 43.639744], [-79.392677, 43.640038], [-79.392707, 43.640139], [-79.392837, 43.640498], [-79.392862, 43.640567], [-79.3929, 43.640666], [-79.392922, 43.640731], [-79.393161, 43.641375], [-79.393208, 43.641502], [-79.393629, 43.642469], [-79.393754, 43.642765], [-79.393815, 43.642895], [-79.393933, 43.64317], [-79.39398, 43.64328], [-79.394109, 43.643515], [-79.394157, 43.643608], [-79.39433, 43.644038], [-79.394444, 43.644313], [-79.394493, 43.644443], [-79.394542, 43.644569], [-79.394608, 43.644738], [-79.394647, 43.644839], [-79.394744, 43.645109], [-79.394784, 43.645219], [-79.394892, 43.645487], [-79.394893, 43.64549], [-79.39479, 43.645511], [-79.393881, 43.645702], [-79.393591, 43.645765], [-79.393479, 43.645789], [-79.392433, 43.646017], [-79.392304, 43.646044], [-79.39231, 43.646058], [-79.392398, 43.646262], [-79.39241, 43.646286], [-79.392519, 43.646506], [-79.392801, 43.647242], [-79.392821, 43.647292], [-79.39283, 43.647315], [-79.392832, 43.64732], [-79.392859, 43.647389], [-79.392975, 43.647665], [-79.393063, 43.647875], [-79.393248, 43.648331], [-79.393283, 43.648416], [-79.393313, 43.648488], [-79.393447, 43.64883], [-79.39348, 43.648919], [-79.3936, 43.64921], [-79.39364, 43.649311], [-79.393646, 43.649328], [-79.393539, 43.649348], [-79.393415, 43.649375], [-79.393294, 43.6494], [-79.392115, 43.649649], [-79.39212, 43.649664], [-79.392154, 43.649754], [-79.392272, 43.650077], [-79.392376, 43.650322], [-79.39251, 43.650635], [-79.392591, 43.650828], [-79.392607, 43.650871], [-79.392631, 43.650926], [-79.392653, 43.650984], [-79.392745, 43.651207], [-79.392986, 43.651782], [-79.393019, 43.651867], [-79.393364, 43.652702], [-79.393387, 43.65276], [-79.393803, 43.653746], [-79.393827, 43.653806], [-79.393832, 43.653816], [-79.393838, 43.653832], [-79.393863, 43.653893], [-79.394034, 43.654323], [-79.394129, 43.654303], [-79.394413, 43.654241]]);
  

    // Things required to do:
    //  1) Transform current route into list of arrays from list of tuples.
    //  2) Set current route equal to a service variable (in trip service) that is accessible globally
    //  3) In routes.component.ts, process the variable as a vectorlayer, and add that layer onto the map.
  }

  openTripSettings() {
    let dialogRefSettings = this.dialog.open(TripSettingsComponent, {
      height: '60vh',
      width: '60vw'
    });

    dialogRefSettings.afterClosed().subscribe(result => {
      this.tripSettings.maximumDetourDuration = result;
    });
  }

  addIntermediaryAddress() {
    let dialogRef = this.dialog.open(AddIntermediateStopComponent, {
      height: '40vh',
      width: '40vw',
    });

    dialogRef.afterClosed().subscribe(result => {
      // Make a backend call to update route with added stop.
      if (result) {
        this.addresses.push(result.value);
        this.intermediateLocationAddress = result.value;
        let joinedAddress = this.addresses.join(',');

        const queryParams: Params = { 
          startingLocation: this.startingLocation, 
          endingLocation: this.endingLocation,
          intermediateLocation: joinedAddress
         };
        this.router.navigate(
          [], 
          {
            relativeTo: this.activatedRoute,
            queryParams: queryParams, 
            queryParamsHandling: 'merge', // remove to replace all query params by provided
          });
    
        this.hasBeenRouted = true;
        this.currentStep = this.routingSteps.tripDetails;
        this.tripService.getIntermediate(this.startingLocation, this.endingLocation, this.tripSettings.maximumDetourDuration, this.addresses).subscribe(request => {
          // send list of addresses to backend as well. If addresses.length == 2, then just do Route(starting, ending), if length > 2, go through
          // list of addresses and route between each 2 locations, append all list of nodes (ensuring there is no overlap), and return that list (this is for intermediate addresses and POIs)
          this.currentRoute = JSON.parse(request.listOfNodes);
        });

        // this.tripService.setListOfNodes();
      }
    });
  }

  hasBeenClicked(tag: string) {
    if (tag === 'restaurant') {
      this.displayRestaurants();
    } else if (tag === 'hotels') {
      this.displayHotels();
    } else {
      this.displayTTD();
    }
  }

  displayRestaurants() {
    this.restaurantClicked = !this.restaurantClicked;
    if (this.restaurantClicked) {
      // this.tripService.getRestaurants().subscribe((request: RestaurantsModel) => {
      //   console.log(request);
      //   this.tripService.setPoiMarkers(request.listOfRestaurantsCoords);
      //   this.restaurants = request.listOfRestaurantsInfo;
      //   console.log(request.listOfRestaurantsInfo);
      //   console.log(request.listOfRestaurantsCoords);
      // });

      const currentRestaurant = this.mockRestaurants;
      this.tripService.setPoiMarkers(currentRestaurant.listOfRestaurantsCoords);
      this.restaurants = currentRestaurant.listOfRestaurantsInfo;
    }
  }

  displayHotels() {
    this.hotelsClicked = !this.hotelsClicked;
    // Add API call here.
  }

  displayTTD() {
    this.ttdClicked = !this.ttdClicked;
    // Add API call here;
  }

  get startingLocation() {
    return this.startTripForm.get('startingLocation').value;
  }

  get endingLocation() {
    return this.startTripForm.get('endingLocation').value;
  }

  get isRouteDisabled() {
    return !(this.startTripForm.get('startingLocation').value &&
      this.startTripForm.get('endingLocation').value)
  }

}
